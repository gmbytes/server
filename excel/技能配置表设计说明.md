# 技能系统 Excel 配置表设计说明

本文档定义了技能系统所需的所有 Excel 配置表结构，支持魔兽世界风格的技能系统。

---

## 配置表清单

1. **Skill.xlsx** - 技能主表
2. **SkillEffect.xlsx** - 技能效果配置表
3. **Buff.xlsx** - Buff/Debuff 配置表
4. **BuffEffect.xlsx** - Buff 效果配置表
5. **TargetSelector.xlsx** - 目标选择配置表
6. **DamageFormula.xlsx** - 伤害公式配置表

---

## 1. Skill.xlsx - 技能主表

### 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **ID** | int | 技能ID（唯一） | 1001 |
| **Name** | string | 技能名称 | 火球术 |
| **Description** | string | 技能描述 | 向目标发射一颗火球，造成火焰伤害 |
| **Icon** | string | 图标资源路径 | icon/skill/fireball.png |
| **SkillType** | int | 技能类型（1=主动，2=被动，3=光环） | 1 |
| **TargetType** | int | 目标类型（1=敌方，2=友方，3=自己，4=全部） | 1 |
| **MaxLevel** | int | 最大等级 | 5 |
| **CooldownMs** | int | 冷却时间（毫秒） | 8000 |
| **CooldownStartStage** | int | CD起始阶段（1=CastStart，2=CastFinish） | 2 |
| **GcdMs** | int | 公共CD（毫秒） | 1500 |
| **GcdStartStage** | int | GCD起始阶段 | 1 |
| **CastTimeMs** | int | 吟唱时间（毫秒，0=瞬发） | 2000 |
| **ChannelTimeMs** | int | 引导时间（毫秒，0=非引导） | 0 |
| **ChannelTickMs** | int | 引导Tick间隔（毫秒） | 0 |
| **Range** | float | 施法距离 | 30.0 |
| **ResourceType** | int | 消耗资源类型（1=法力，2=能量，3=怒气等） | 1 |
| **ResourceCost** | int | 资源消耗量 | 150 |
| **TargetSelectorID** | int | 目标选择器ID（关联TargetSelector表） | 101 |
| **EffectIDs** | string | 效果ID列表（逗号分隔） | 1001,1002,1003 |
| **RequireBuffID** | int | 需要的Buff ID（0=无要求） | 0 |
| **ConsumeBuffID** | int | 消耗的Buff ID（0=不消耗） | 0 |
| **CanCastWhileMoving** | bool | 是否可移动施法 | false |
| **CanCastWhileStunned** | bool | 是否可眩晕时施法 | false |
| **InterruptibleByDamage** | bool | 是否可被伤害打断 | true |
| **InterruptibleByCC** | bool | 是否可被控制打断 | true |
| **SchoolMask** | int | 法术学校掩码（1=物理，2=火焰，4=冰霜，8=自然等） | 2 |
| **Tags** | string | 标签（逗号分隔，用于分类） | AOE,Fire,Damage |

### 示例数据

```
ID    Name      Description                CastTimeMs  CooldownMs  ResourceCost  EffectIDs
1001  火球术    造成火焰伤害                2000        8000        150          10001,10002
1002  闪现      瞬移到目标位置              0           15000       200          10010
1003  暴风雪    持续造成范围冰霜伤害        0           8000        300          10020,10021
1004  治疗术    治疗友方目标                2500        0           180          10030
```

---

## 2. SkillEffect.xlsx - 技能效果配置表

### 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **ID** | int | 效果ID（唯一） | 10001 |
| **Name** | string | 效果名称 | 火球伤害 |
| **EffectType** | int | 效果类型（见下方枚举） | 1 |
| **Stage** | int | 执行阶段（1=CastStart，2=CastFinish，3=Channel，4=Hit） | 4 |
| **DelayMs** | int | 延迟时间（毫秒） | 500 |
| **Times** | int | 执行次数 | 1 |
| **IntervalMs** | int | 执行间隔（毫秒） | 0 |
| **DamageFormulaID** | int | 伤害公式ID（关联DamageFormula表） | 1001 |
| **HealFormulaID** | int | 治疗公式ID | 0 |
| **BuffID** | int | 施加的Buff ID | 0 |
| **BuffDurationMs** | int | Buff持续时间（毫秒） | 0 |
| **BuffStacks** | int | Buff层数 | 0 |
| **DispelType** | int | 驱散类型（1=魔法，2=诅咒，3=毒，4=疾病） | 0 |
| **DispelCount** | int | 驱散数量 | 0 |
| **MoveType** | int | 位移类型（1=瞬移，2=冲锋，3=击退） | 0 |
| **MoveDistance** | float | 位移距离 | 0 |
| **SummonID** | int | 召唤物ID | 0 |
| **ThreatValue** | int | 仇恨值 | 0 |
| **AreaID** | int | 区域效果ID | 0 |
| **P1** | int | 参数1（通用） | 0 |
| **P2** | int | 参数2（通用） | 0 |
| **P3** | int | 参数3（通用） | 0 |
| **P4** | int | 参数4（通用） | 0 |

### EffectType 枚举

```
1  = Damage          // 伤害
2  = Heal            // 治疗
3  = ApplyBuff       // 施加Buff
4  = Dispel          // 驱散
5  = Steal           // 偷取
6  = Move            // 位移
7  = Interrupt       // 打断
8  = Summon          // 召唤
9  = Threat          // 仇恨修改
10 = SpawnArea       // 生成区域
11 = Teleport        // 传送
12 = Knockback       // 击退
13 = Pull            // 拉拽
14 = ResourceRestore // 资源恢复
```

### 示例数据

```
ID     Name          EffectType  Stage  DelayMs  DamageFormulaID  BuffID
10001  火球伤害      1           4      500      1001             0
10002  火球灼烧      3           4      500      0                2001
10010  闪现位移      6           2      0        0                0
10020  暴风雪伤害    1           3      0        1002             0
10021  暴风雪减速    3           3      0        0                2002
```

---

## 3. Buff.xlsx - Buff/Debuff 配置表

### 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **ID** | int | Buff ID（唯一） | 2001 |
| **Name** | string | Buff名称 | 灼烧 |
| **Description** | string | Buff描述 | 持续受到火焰伤害 |
| **Icon** | string | 图标路径 | icon/buff/burn.png |
| **BuffType** | int | Buff类型（1=增益，2=减益，3=中性） | 2 |
| **DurationMs** | int | 持续时间（毫秒，-1=永久） | 6000 |
| **MaxStacks** | int | 最大层数 | 1 |
| **StackRule** | int | 叠加规则（见下方枚举） | 1 |
| **DispelType** | int | 驱散类型（1=魔法，2=诅咒，3=毒，4=疾病，5=激怒） | 1 |
| **CanDispel** | bool | 是否可驱散 | true |
| **CanSteal** | bool | 是否可偷取 | false |
| **Priority** | int | 优先级（用于覆盖判断） | 1 |
| **EffectIDs** | string | Buff效果ID列表（逗号分隔） | 20001,20002 |
| **ImmunityMask** | int | 免疫掩码（位掩码，免疫的控制类型） | 0 |
| **Tags** | string | 标签 | DoT,Fire,Debuff |

### StackRule 枚举

```
1 = NoStack           // 不可叠加（刷新时间）
2 = RefreshDuration   // 刷新时间（层数不变）
3 = AddStack          // 叠层增加（刷新时间）
4 = AddStackNoRefresh // 叠层增加（不刷新时间）
5 = Independent       // 独立计时（可多实例）
6 = ReplaceIfStronger // 取更强
7 = ReplaceIfLonger   // 取更长
```

### 示例数据

```
ID    Name      Description          DurationMs  MaxStacks  StackRule  DispelType  EffectIDs
2001  灼烧      持续火焰伤害          6000        1          1          1           20001
2002  减速      移动速度降低50%       4000        1          1          1           20002
2003  护盾      吸收伤害              10000       1          1          1           20003
2004  嗜血      攻击速度提升30%       40000       1          1          1           20004
```

---

## 4. BuffEffect.xlsx - Buff 效果配置表

### 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **ID** | int | Buff效果ID（唯一） | 20001 |
| **Name** | string | 效果名称 | 灼烧伤害 |
| **EffectType** | int | 效果类型（见下方枚举） | 1 |
| **TriggerType** | int | 触发类型（1=周期，2=事件，3=持续） | 1 |
| **TickIntervalMs** | int | Tick间隔（毫秒） | 2000 |
| **MaxTicks** | int | 最大Tick次数（0=无限） | 0 |
| **EventType** | int | 触发事件类型（TriggerType=2时有效） | 0 |
| **TriggerChance** | float | 触发概率（0-1） | 1.0 |
| **CooldownMs** | int | 内置冷却（毫秒） | 0 |
| **AttributeType** | int | 属性类型（EffectType=AttributeMod时） | 0 |
| **ModType** | int | 修改类型（1=加法，2=乘法） | 0 |
| **ModValue** | int | 修改值 | 0 |
| **DamageFormulaID** | int | 伤害公式ID | 1003 |
| **HealFormulaID** | int | 治疗公式ID | 0 |
| **ShieldAmount** | int | 护盾吸收量 | 0 |
| **CCType** | int | 控制类型（1=眩晕，2=沉默，3=定身等） | 0 |
| **MoveSpeedPct** | float | 移速修改（百分比） | 0 |
| **AttackSpeedPct** | float | 攻速修改（百分比） | 0 |
| **CastSpeedPct** | float | 施法速度修改（百分比） | 0 |
| **P1** | int | 参数1 | 0 |
| **P2** | int | 参数2 | 0 |

### EffectType 枚举

```
1  = PeriodicDamage      // 周期伤害（DoT）
2  = PeriodicHeal        // 周期治疗（HoT）
3  = AttributeMod        // 属性修改
4  = Shield              // 护盾
5  = CrowdControl        // 控制状态
6  = MoveSpeedMod        // 移速修改
7  = AttackSpeedMod      // 攻速修改
8  = CastSpeedMod        // 施法速度修改
9  = ProcOnDamageDealt   // 造成伤害时触发
10 = ProcOnDamageTaken   // 受到伤害时触发
11 = ProcOnCrit          // 暴击时触发
12 = ProcOnCast          // 施法时触发
13 = Immunity            // 免疫
14 = DamageReflect       // 伤害反弹
15 = Aura                // 光环
```

### 示例数据

```
ID     Name          EffectType  TriggerType  TickIntervalMs  DamageFormulaID  MoveSpeedPct
20001  灼烧伤害      1           1            2000            1003             0
20002  减速效果      6           3            0               0                -0.5
20003  护盾吸收      4           3            0               0                0
20004  嗜血加速      7           3            0               0                0.3
```

---

## 5. TargetSelector.xlsx - 目标选择配置表

### 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **ID** | int | 选择器ID（唯一） | 101 |
| **Name** | string | 选择器名称 | 单体敌方 |
| **Mode** | int | 选择模式（1=单位，2=点，3=自己，4=无目标） | 1 |
| **Shape** | int | 形状（1=圆形，2=扇形，3=矩形，4=环形，5=直线） | 1 |
| **Radius** | float | 半径 | 5.0 |
| **Angle** | float | 角度（扇形） | 0 |
| **Width** | float | 宽度（矩形） | 0 |
| **Length** | float | 长度（矩形/直线） | 0 |
| **InnerRadius** | float | 内半径（环形） | 0 |
| **Relation** | int | 目标关系（1=自己，2=友方，3=敌方，4=全部） | 3 |
| **MinHP** | int | 最低血量（0=无限制） | 0 |
| **MaxHP** | int | 最高血量（0=无限制） | 0 |
| **MinHPPct** | float | 最低血量百分比（0-1） | 0 |
| **MaxHPPct** | float | 最高血量百分比（0-1） | 0 |
| **RequireBuffID** | int | 需要的Buff ID | 0 |
| **ExcludeBuffID** | int | 排除的Buff ID | 0 |
| **Sort** | int | 排序方式（1=最近，2=最远，3=血量最低，4=血量最高） | 0 |
| **MaxCount** | int | 最大目标数（0=无限制） | 1 |
| **IncludeCaster** | bool | 是否包含施法者 | false |
| **IncludeDead** | bool | 是否包含死亡单位 | false |

### 示例数据

```
ID   Name          Mode  Shape  Radius  Relation  MaxCount  Sort
101  单体敌方      1     1      0       3         1         0
102  5码圆形AOE    2     1      5.0     3         0         0
103  前方扇形      2     2      10.0    3         0         0
104  自己          3     1      0       1         1         0
105  友方单体      1     1      0       2         1         0
```

---

## 6. DamageFormula.xlsx - 伤害公式配置表

### 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **ID** | int | 公式ID（唯一） | 1001 |
| **Name** | string | 公式名称 | 火球伤害公式 |
| **DamageType** | int | 伤害类型（1=物理，2=法术，3=真实） | 2 |
| **School** | int | 伤害学校（1=物理，2=火焰，4=冰霜，8=自然等） | 2 |
| **BaseDamage** | int | 基础伤害 | 500 |
| **BaseDamagePerLevel** | int | 每级增加的基础伤害 | 50 |
| **APCoefficient** | float | 攻击强度系数 | 0 |
| **SPCoefficient** | float | 法术强度系数 | 0.8 |
| **TargetHPCoefficient** | float | 目标生命值系数 | 0 |
| **TargetMissingHPCoefficient** | float | 目标缺失生命值系数 | 0 |
| **CasterHPCoefficient** | float | 施法者生命值系数 | 0 |
| **ExecuteThreshold** | float | 斩杀阈值（血量百分比） | 0 |
| **ExecuteBonus** | float | 斩杀增伤（百分比） | 0 |
| **CanCrit** | bool | 是否可暴击 | true |
| **CritMultiplier** | float | 暴击倍率 | 2.0 |
| **CanDodge** | bool | 是否可躲闪 | true |
| **CanBlock** | bool | 是否可格挡 | false |
| **CanParry** | bool | 是否可招架 | false |
| **IgnoreArmorPct** | float | 忽视护甲百分比 | 0 |
| **SplashRadius** | float | 溅射半径（0=无溅射） | 0 |
| **SplashDamagePct** | float | 溅射伤害百分比 | 0 |
| **MinDamage** | int | 最小伤害 | 0 |
| **MaxDamage** | int | 最大伤害 | 0 |

### 公式说明

```
最终伤害 = (BaseDamage + BaseDamagePerLevel * Level 
          + AttackPower * APCoefficient 
          + SpellPower * SPCoefficient
          + TargetMaxHP * TargetHPCoefficient
          + TargetMissingHP * TargetMissingHPCoefficient
          + CasterMaxHP * CasterHPCoefficient)
          * (1 + ExecuteBonus if TargetHP < ExecuteThreshold)
          * CritMultiplier if Crit
          * (1 - ArmorReduction)
          * (1 + DamageBuffs)
          - ShieldAbsorb
```

### 示例数据

```
ID    Name              DamageType  School  BaseDamage  SPCoefficient  CanCrit  CritMultiplier
1001  火球伤害公式      2           2       500         0.8            true     2.0
1002  暴风雪伤害公式    2           4       300         0.6            true     2.0
1003  灼烧伤害公式      2           2       100         0.4            false    1.0
1004  物理攻击公式      1           1       0           0              true     2.0
```

---

## 配置表关系图

```
Skill (技能主表)
  ├─> TargetSelector (目标选择)
  └─> SkillEffect (技能效果)
        ├─> DamageFormula (伤害公式)
        ├─> HealFormula (治疗公式)
        └─> Buff (Buff配置)
              └─> BuffEffect (Buff效果)
                    ├─> DamageFormula (DoT伤害公式)
                    └─> HealFormula (HoT治疗公式)
```

---

## 使用示例

### 示例1：火球术

**Skill 表**
```
ID: 1001
Name: 火球术
CastTimeMs: 2000
CooldownMs: 8000
ResourceCost: 150
TargetSelectorID: 101 (单体敌方)
EffectIDs: 10001,10002
```

**SkillEffect 表**
```
ID: 10001
Name: 火球伤害
EffectType: 1 (Damage)
Stage: 4 (Hit)
DelayMs: 500
DamageFormulaID: 1001

ID: 10002
Name: 火球灼烧
EffectType: 3 (ApplyBuff)
Stage: 4 (Hit)
BuffID: 2001
BuffDurationMs: 6000
```

**Buff 表**
```
ID: 2001
Name: 灼烧
DurationMs: 6000
EffectIDs: 20001
```

**BuffEffect 表**
```
ID: 20001
Name: 灼烧伤害
EffectType: 1 (PeriodicDamage)
TriggerType: 1 (周期)
TickIntervalMs: 2000
DamageFormulaID: 1003
```

---

## 注意事项

1. **ID 分配规则**
   - Skill: 1000-9999
   - SkillEffect: 10000-19999
   - Buff: 2000-29999
   - BuffEffect: 20000-29999
   - TargetSelector: 100-999
   - DamageFormula: 1000-9999

2. **位掩码使用**
   - SchoolMask: 可以组合多个学校（如 2|4 = 火焰+冰霜）
   - ImmunityMask: 可以组合多个免疫类型

3. **性能考虑**
   - 避免过多的周期效果（DoT/HoT）
   - 光环系统需要优化范围检测频率
   - 大量单位时注意 Buff 管理性能

4. **扩展性**
   - 所有表都预留了 P1-P4 参数字段用于特殊需求
   - Tags 字段可用于分类和过滤

---

**最后更新**：2026-02-03
